$(function(){$("#addLocaBtn").click(function(t){var i=$("#suggestId").val();$("#activityAddress").val(i)}),$("#activityStartTime").change(function(t){var i=$(this).val();$("input[name=activityStartTime]").val(toUnixTimestamp(i))}),$("#activityEndTime").change(function(t){var i=$(this).val();$("input[name=activityEndTime]").val(toUnixTimestamp(i))}),$("#activityAddForm").on("submit",function(t){t.preventDefault();var a=$("#submitBtn");a.addClass("disabled").attr("disabled","disabled").text("发布中…");var e=$("#log img"),n="";for(i=0;i<e.length;i++)n+=e[i].src.replace("!coupon1",";");var s=n.substring(0,n.length-1),c={activityTitle:$("#activityTitle").val(),activityContent:$("#activityContent").val(),activityCoverPic:s,activityLushuId:parseInt($('input[name="activityLushuId"]').val()),activityMiles:parseInt(1e3*$('input[name="activityMiles"]').val()),activityType:$("input[name=activityType]:checked").val(),activityStartTime:parseInt($('input[name="activityStartTime"]').val()),activityEndTime:parseInt($('input[name="activityEndTime"]').val()),activityCost:parseInt($('input[name="activityCost"]').val()),activityUserMaxCount:parseInt($('input[name="activityUserMaxCount"]').val()),activityContactMobile:parseInt($('input[name="activityContactMobile"]').val()),activityCity:parseInt($('input[name="activityCity"]').val()),activityLat:parseFloat($('input[name="activityLat"]').val()),activityLon:parseFloat($('input[name="activityLon"]').val()),activityAddress:$('input[name="activityAddress"]').val()};console.log(c);var v="/api/v4/create_new_activity";$.ajax({url:v,type:"POST",data:JSON.stringify(c),contentType:"application/json"}).done(function(t){function i(t){a.text("发布成功 "+t),0===t?window.location.assign("/activities/"):(t-=1,setTimeout(function(){i(t)},1e3))}console.log(t),console.log("success!"),a.addClass("btn-success").text("发布成功"),i(3)}).fail(function(t,i,e){function n(t){0===t?a.removeClass("disabled btn-danger").removeAttr("disabled").text("发布"):(t-=1,setTimeout(function(){n(t)},1e3))}n(3);for(var s in JSON.parse(t.responseText));a.addClass("btn-danger").text(JSON.parse(t.responseText).error_message)}).always(function(t,i){console.log("complete")})}),$("#activityEditForm").on("submit",function(t){t.preventDefault();var a=$("#submitBtn"),e="/api/v4/edit_activity";a.addClass("disabled").attr("disabled","disabled").text("保存中…");var n=$("#log img"),s="";for(i=0;i<n.length;i++)s+=n[i].src.replace("!coupon1",";");console.log("img length: "+n.length),console.log("imagesStr: "+s);var c=s.substring(0,s.length-1),v={activityId:parseInt($("#activityId").val()),activityTitle:$("#activityTitle").val(),activityContent:$("#activityContent").val(),activityCoverPic:c,activityLushuId:parseInt($('input[name="activityLushuId"]').val()),activityMiles:parseInt(1e3*$('input[name="activityMiles"]').val()),activityType:parseInt($("input[name=activityType]:checked").val()),activityStartTime:parseInt($('input[name="activityStartTime"]').val()),activityEndTime:parseInt($('input[name="activityEndTime"]').val()),activityCost:parseInt($('input[name="activityCost"]').val()),activityUserMaxCount:parseInt($('input[name="activityUserMaxCount"]').val()),activityContactMobile:parseInt($('input[name="activityContactMobile"]').val()),activityCity:parseInt($('input[name="activityCity"]').val()),activityLat:parseFloat($('input[name="activityLat"]').val()),activityLon:parseFloat($('input[name="activityLon"]').val()),activityAddress:$('input[name="activityAddress"]').val()};console.log(v),$.ajax({url:e,type:"POST",data:JSON.stringify(v),contentType:"application/json"}).done(function(t){function i(t){a.text("修改成功 "+t),0===t?window.location.assign("/activities/"):(t-=1,setTimeout(function(){i(t)},1e3))}a.addClass("btn-success").text("修改成功"),i(3)}).fail(function(t,i,e){function n(t){0===t?a.removeClass("disabled btn-danger").removeAttr("disabled").text("保存修改"):(t-=1,setTimeout(function(){n(t)},1e3))}n(3);for(var s in JSON.parse(t.responseText));a.addClass("btn-danger").text(JSON.parse(t.responseText).error_message)}).always(function(t,i){console.log("complete")})})});