$(function(){function e(){C=$("#voteCaptchaInput").val(),setTimeout(function(){$("#getCodeBtn").removeClass("disabled")},500)}function t(e){for(var t=document.cookie,n=t.split("; "),a=0;a<n.length;a++){var s=n[a].split("=");if(e===s[0])return s[1]}return""}var n=function(e){return""!==e},a=function(e){var t=/^(13[0-9]|14[57]|15[0-9]|17[0-9]|18[0-9])\d{8}$/;return t.test(e)},s=function(e){var t=/^([a-zA-Z0-9]+[-_.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[-_.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,6}$/;return t.test(e)},i=$("#inputMobile"),o=$("#getCodeBtn"),r=($("#inputCode"),$("#inputPsw")),l=$("#inputPswRepeat"),c=$("#resetPswBtn"),u=$("#inputEmail"),d=$("#sendEmailBtn"),p="/user/find_password",v="/api/v4/captcha_reg",f=$("#voteCaptchaImg"),g=function(){$.get(v,function(){f.attr("src",v)})};g(),f.on("click",function(){g()});var C="";$("#getCodeBtn").addClass("disabled"),$("#voteCaptchaInput").keyup(function(){4==$("#voteCaptchaInput").val().length?e():$("#getCodeBtn").addClass("disabled")}),$("#getCodeBtn").on("click",function(){if($(this).hasClass("disabled"))event.preventDefault();else{var e=i.val();a(e)?$.ajax({url:"/api/v4/send_msg",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({account:e,type:5,isvoice:0,code:C}),success:function(e){o.addClass("disabled").text("60秒");var t=(new Date).getTime(),n=setInterval(function(){var e=(new Date).getTime(),a=Math.ceil(60-(e-t)/1e3);a>0?o.text(a+"s秒"):(clearInterval(n),o.removeClass("disabled").text("点击获取"))},1e3)},error:function(e){$.alert(JSON.parse(e.responseText).error_message)}}):$.alert("请输入正确的手机号")}}),$(document).on("click","#getVoiceCodeBtn",function(e){var t=i.val();a(t)?$.ajax({url:"/api/v4/send_msg",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({account:t,type:5,isvoice:1,code:C}),success:function(e){$.alert("获取成功！请注意接听电话")},error:function(e){$.alert(JSON.parse(e.responseText).error_message)}}):$.alert("请输入正确的手机号")}),$("#resetPswMobile").on("input","input",function(e){var t=$("#inputMobile").val(),s=$("#inputCode").val,i=$("#inputPsw").val(),o=$("#inputPswRepeat").val();a(t)&&n(s)&&n(i)&&n(o)?c.removeClass("disabled"):c.addClass("disabled")}),$(document).on("click","#resetPswBtn",function(e){if($(this).hasClass("disabled"))e.preventDefault();else{var n=$("#inputMobile").val(),a=$("#inputCode").val(),s=$("#inputPsw").val(),i=$("#inputPswRepeat").val();if(r.val()!==l.val())$.alert("两次密码必须一致");else if(s.length<6||i.length<6)$.alert("密码太短了");else{var o=t("rd"),c=$("#pubkey").val(),u=i+";"+o,d=new JSEncrypt;d.setPublicKey(c),u=d.encrypt(u),$.ajax({url:p,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({account:n,password:u,keycode:parseInt(a)}),success:function(e){$.alert("新密码设置成功！"),window.location.assign("/user/find_password")},error:function(e){$.alert(JSON.parse(e.responseText).error_message)}})}}}),$(document).on("pageInit","#resetPswMail",function(e,t,n){$(n).on("input","#inputEmail",function(){s($(this).val())?d.removeClass("disabled"):d.addClass("disabled")})}),$(document).on("pageInit","#resetPswMail",function(e,t,n){$(n).on("click","#sendEmailBtn",function(){$(this).hasClass("disabled")?(console.log("没输入邮箱"),event.preventDefault()):($.showPreloader("发送中…"),$.ajax({type:"POST",url:p,data:JSON.stringify({account:u.val()}),success:function(e){$.hidePreloader(),$.alert("邮件验证发送成功")},error:function(e){$.hidePreloader(),$.alert(JSON.parse(e.responseText).error_message)}}))})}),$.init()});