function loadJScript(){var e=document.createElement("script");e.type="text/javascript",e.src="http://api.map.baidu.com/api?v=2.0&ak=1410015343234e42388452d3087a8a2e&callback=init",document.body.appendChild(e)}function G(e){return document.getElementById(e)}function init(){function e(){function e(){var e=r.getResults().getPoi(0).point;l.centerAndZoom(e,17);var c=new BMap.Marker(e);c.enableDragging(),l.addOverlay(c);var d=c.getPosition();console.log(d.lng+", "+d.lat),t.value=d.lat,n.value=d.lng,c.addEventListener("dragend",function(e){console.log(e.point.lng+", "+e.point.lat),t.value=e.point.lat,n.value=e.point.lng,i.getLocation(new BMap.Point(e.point.lng,e.point.lat),function(e){e&&(console.log(e.address),console.log(e.addressComponents.city),o.value=e.address,a.value=letCityStrToIndexNum(e.addressComponents.city))})})}l.clearOverlays();var r=new BMap.LocalSearch(l,{onSearchComplete:e});r.search(d)}var t=document.getElementById("activityLat"),n=document.getElementById("activityLon"),o=document.getElementById("suggestId"),a=document.getElementById("activityCity"),i=new BMap.Geocoder,l=new BMap.Map("l-map");l.centerAndZoom("上海",16),l.enableScrollWheelZoom(),l.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL}));var r=new BMap.Geolocation;r.getCurrentPosition(function(e){if(this.getStatus()==BMAP_STATUS_SUCCESS){var r=new BMap.Marker(e.point);l.addOverlay(r),l.panTo(e.point),r.enableDragging();var c=r.getPosition();console.log(c.lng+", "+c.lat),t.value=c.lat,n.value=c.lng,r.addEventListener("dragend",function(e){console.log(e.point.lng+", "+e.point.lat),t.value=e.point.lat,n.value=e.point.lng,i.getLocation(new BMap.Point(e.point.lng,e.point.lat),function(e){e&&(console.log(e.address),console.log(e.addressComponents.city),o.value=e.address,a.value=letCityStrToIndexNum(e.addressComponents.city))})})}else alert("failed"+this.getStatus())},{enableHighAccuracy:!0});var c=new BMap.Autocomplete({input:"suggestId",location:l});c.addEventListener("onhighlight",function(e){var t="",n=e.fromitem.value,o="";e.fromitem.index>-1&&(o=n.province+n.city+n.district+n.street+n.business),t="FromItem<br />index = "+e.fromitem.index+"<br />value = "+o,o="",e.toitem.index>-1&&(n=e.toitem.value,o=n.province+n.city+n.district+n.street+n.business),t+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+o,G("searchResultPanel").innerHTML=t});var d;c.addEventListener("onconfirm",function(t){var n=t.item.value;d=n.province+n.city+n.district+n.street+n.business,G("searchResultPanel").innerHTML="onconfirm<br />index = "+t.item.index+"<br />myValue = "+d,console.log(n.city),a.value=letCityStrToIndexNum(n.city),e()})}document.getElementById("activityAddress").onclick=loadJScript;