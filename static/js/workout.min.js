var map;var bound;var route;var startMarker;var stopMarker;var curPosMarker;var startPosition;var stopPosition;var chart;$(init);function init(){initMap();$("#toggleWorkout").click(toggleWorkout);$("#toggleDeleteWorkout").click(toggleDeleteWorkout);$("#changeMapSize").click(changeMapSize);$("#exportGpx").click(exportCheck);$("#exportKml").click(exportCheck);chart=createChart()}function initMap(){startPosition=points[0];stopPosition=points[points.length-1];var b={zoom:14,center:points[0],mapTypeId:google.maps.MapTypeId.ROADMAP};if(min_lat*min_lng*max_lat*max_lng!=0){var a=new google.maps.LatLng(min_lat,min_lng);var c=new google.maps.LatLng(max_lat,max_lng);bound=new google.maps.LatLngBounds(a,c)}map=new google.maps.Map(document.getElementById("map_canvas"),b);if(!!bound){map.fitBounds(bound)}map.controls[google.maps.ControlPosition.TOP_RIGHT].push($("#changeMapSize").get(0));route=new google.maps.Polyline({path:points,strokeColor:"#33B5E5",strokeOpacity:1,strokeWeight:4});route.setMap(map);startMarker=new google.maps.Marker({position:startPosition,map:map,icon:"/static/images/map/1.png",title:"开始",draggable:true});stopMarker=new google.maps.Marker({position:stopPosition,map:map,icon:"/static/images/map/2.png",title:"停止"});google.maps.event.addListener(startMarker,"dragend",onMarkerDragEnd)}function formatTime(b){var a=new Date(b);return a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}Highcharts.setOptions({lang:{exportButtonTitle:"导出",printButtonTitle:"打印",downloadPNG:"导出PNG",downloadJPEG:"导出JPEG",downloadPDF:"导出PDF",downloadSVG:"",resetZoom:"恢复",resetZoomTitle:"恢复"}});function createChart(){return new Highcharts.Chart({chart:{zoomType:"x",renderTo:"chart"},title:{text:"速度和海拔"},subtitle:{text:""},xAxis:{labels:{formatter:function(){}}},yAxis:[{title:{text:"速度",style:{color:"#369BD7"}},labels:{style:{color:"#369BD7"},formatter:function(){return this.value+" km/h"}},min:0},{labels:{style:{color:"#a0a095"},formatter:function(){return this.value+" m"}},title:{text:"海拔",style:{color:"#a0a095"}},min:min_altitude,opposite:true}],tooltip:{formatter:function(){var b=this.points[0];var a=this.points[1];return"速度："+b.y+"公里/小时<br />海拔："+a.y+" 米<br />时间："+formatTime(timeData[this.x])+"<br />距离：≈"+distanceOfPoints[this.x]+" 公里"},shared:true,crosshairs:true},plotOptions:{series:{marker:{enabled:false},point:{events:{mouseOver:function(){var a=points[this.x];if(!curPosMarker){curPosMarker=new google.maps.Marker({position:a,map:map,icon:"/static/images/map/marker.png"})}else{curPosMarker.setPosition(a)}}}}},line:{lineWidth:1.5,states:{hover:{lineWidth:1.5}}},areaspline:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,"rgba(2,0,0,0)"]]},lineWidth:1,marker:{enabled:false,states:{hover:{enabled:true,radius:5}}},shadow:false,states:{hover:{lineWidth:1}}}},legend:{enabled:false},series:[{name:"速度",color:"#33B5E5",type:"line",shadow:false,zIndex:1,data:speedData},{name:"海拔",color:"#a0a095",type:"areaspline",shadow:false,data:altitudeData,yAxis:1,zIndex:0}]})};